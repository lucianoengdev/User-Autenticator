{% extends 'base.html' %}

{% block style %}
<style>
    .result-card {
        background-color: #e8f5e9; 
        border-left: 5px solid #198754;
        padding: 20px;
        margin-top: 20px;
        border-radius: 5px;
    }
    .result-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #198754;
    }
</style>
{% endblock %}

{% block content %}
<div class="container pb-5">
    <div class="row">
        <div class="col-md-6">
            <h2 class="mb-4 text-success">Cálculo de Velocidade e Geometria</h2>
            <p class="text-muted mb-4">Insira os dados da via e do veículo para determinar os limites operacionais.</p>
            
            {% if form.errors %}
                <div class="alert alert-danger">
                    <ul class="mb-0">
                    {% for field, errors in form.errors.items() %}
                        {% for error in errors %}
                            <li>{{ field }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    </ul>
                </div>
            {% endif %}
            
            <form method="POST">
                {{ form.hidden_tag() }}
                
                <h5 class="mb-3 border-bottom pb-2">Geometria da Curva</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            {{ form.raio(class="form-control", placeholder=" ") }}
                            {{ form.raio.label }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            {{ form.superelevacao(class="form-control", placeholder=" ") }}
                            {{ form.superelevacao.label }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            {{ form.bitola(class="form-control", placeholder=" ") }}
                            {{ form.bitola.label }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            {{ form.largura_boleto(class="form-control", placeholder=" ") }}
                            {{ form.largura_boleto.label }}
                        </div>
                    </div>
                </div>

                <h5 class="mb-3 border-bottom pb-2 mt-3">Veículo e Segurança</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            {{ form.altura_cg(class="form-control", placeholder=" ") }}
                            {{ form.altura_cg.label }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            {{ form.coef_seguranca(class="form-control", placeholder=" ") }}
                            {{ form.coef_seguranca.label }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            {{ form.deslocamento_cg(class="form-control", placeholder=" ") }}
                            {{ form.deslocamento_cg.label }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            {{ form.velocidade(class="form-control", placeholder=" ") }}
                            {{ form.velocidade.label }}
                            <div class="form-text">Usado p/ cálculo do Raio Mínimo.</div>
                        </div>
                    </div>
                </div>
                
                <h5 class="mb-3 border-bottom pb-2 mt-3">Conforto</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            {{ form.aceleracao_jc(class="form-control", placeholder=" ") }}
                            {{ form.aceleracao_jc.label }}
                        </div>
                    </div>
                    <div class="col-md-6">
                         <div class="form-floating mb-3">
                            {{ form.gravidade(class="form-control", placeholder=" ") }}
                            {{ form.gravidade.label }}
                        </div>
                    </div>
                </div>

                {{ form.submit(class="btn btn-success w-100 py-3 mt-4") }}
            </form>
        </div>

        <div class="col-md-6">
            <h2 class="mb-4">Resultados Operacionais</h2>
            {% if resultados %}
                <div class="row">
                    <div class="col-md-6">
                        <div class="result-card">
                            <h5>V. Máx (Segurança)</h5>
                            <div class="result-value">{{ resultados.v_max_seg }} km/h</div>
                            <small class="text-muted">Limite de tombamento</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="result-card">
                            <h5>V. Máx (Conforto)</h5>
                            <div class="result-value">{{ resultados.v_max_conf }} km/h</div>
                            <small class="text-muted">Jc = {{ form.aceleracao_jc.data }} m/s²</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="result-card" style="border-color: #ffc107;">
                            <h5 class="text-dark">V. Mínima</h5>
                            <div class="result-value" style="color: #bfa12f;">{{ resultados.v_min }} km/h</div>
                            <small class="text-muted">Trens lentos / parados</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="result-card" style="border-color: #0dcaf0;">
                            <h5 class="text-dark">Superlargura</h5>
                            <div class="result-value" style="color: #0aa2c0;">{{ resultados.superlargura_mm }} mm</div>
                            <small class="text-muted">Alargamento da bitola</small>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="result-card bg-white border shadow-sm">
                            <h5>Raio Mínimo Exigido</h5>
                            <p>Para a velocidade desejada de <strong>{{ form.velocidade.data }} km/h</strong>:</p>
                            <div class="result-value text-dark">{{ resultados.r_min }} m</div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-light border text-center p-5">
                    <h4>Aguardando Dados...</h4>
                    <p>Preencha o formulário para calcular os parâmetros de velocidade e geometria.</p>
                </div>
            {% endif %}
        </div>
        {% if memoria %}
        <div class="accordion mt-4 shadow-sm" id="accordionMemoria">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button collapsed fw-bold text-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                        <i class="bi bi-calculator me-2"></i> Ver Memória de Cálculo Detalhada
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionMemoria">
                    <div class="accordion-body bg-light">
                        <ul class="list-group list-group-flush font-monospace small">
                            {% for passo in memoria %}
                            <li class="list-group-item bg-light border-0 py-1">{{ passo }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
